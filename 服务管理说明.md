# 小红书 MCP 服务管理脚本

## 快速使用

### 启动服务

```bash
# 无头模式启动（后台运行，推荐）
./start_service.sh

# 或者明确指定无头模式
./start_service.sh headless

# 显示浏览器界面模式（用于调试）
./start_service.sh gui
```

### 停止服务

```bash
./stop_service.sh
```

## 详细说明

### start_service.sh - 启动脚本

**功能特性：**
- ✅ 自动检查并停止已运行的服务
- ✅ 支持两种运行模式（无头模式/GUI模式）
- ✅ 自动设置Go代理（解决网络问题）
- ✅ 服务健康检查
- ✅ PID文件管理
- ✅ 日志文件记录
- ✅ 彩色输出提示

**运行模式：**

1. **无头模式（headless）** - 默认
   - 后台运行，不显示浏览器界面
   - 适合生产环境使用
   - 生成PID文件用于管理
   - 日志输出到文件

2. **GUI模式（gui）**
   - 显示浏览器界面
   - 适合调试和观察操作过程
   - 前台运行，Ctrl+C停止

**输出文件：**
- `xiaohongshu-mcp.pid` - 进程ID文件
- `xiaohongshu-mcp.log` - 服务日志文件

### stop_service.sh - 停止脚本

**功能特性：**
- ✅ 优雅停止进程（先SIGTERM，再SIGKILL）
- ✅ 端口占用检查和清理
- ✅ 多种方式查找并停止相关进程
- ✅ 清理PID和临时文件
- ✅ 可选择停止Chromium进程
- ✅ 彩色输出提示

## 使用示例

### 1. 日常使用（推荐）

```bash
# 启动服务
./start_service.sh

# 查看服务状态
curl -X POST http://localhost:18060/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"initialize","params":{},"id":1}'

# 停止服务
./stop_service.sh
```

### 2. 调试模式

```bash
# 以GUI模式启动，可以看到浏览器操作
./start_service.sh gui

# 在另一个终端窗口测试功能
curl -X POST http://localhost:18060/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"check_login_status","arguments":{}},"id":2}'

# 停止服务（Ctrl+C 或使用停止脚本）
./stop_service.sh
```

### 3. 查看日志

```bash
# 查看完整日志
cat xiaohongshu-mcp.log

# 实时查看日志
tail -f xiaohongshu-mcp.log

# 清理日志
rm xiaohongshu-mcp.log
```

## 故障排除

### 1. 端口被占用

如果启动时提示端口被占用，脚本会自动处理。如果仍有问题：

```bash
# 手动查找占用端口的进程
lsof -i:18060

# 手动停止进程
kill -9 <PID>
```

### 2. 服务无法启动

```bash
# 检查Go是否正确安装
go version

# 检查项目依赖
go mod tidy

# 查看详细错误日志
cat xiaohongshu-mcp.log
```

### 3. 登录状态丢失

```bash
# 重新登录
go run cmd/login/main.go

# 然后重启服务
./stop_service.sh
./start_service.sh
```

## 集成到其他工具

### Cursor MCP 配置

在项目根目录创建 `.cursor/mcp.json`：

```json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "url": "http://localhost:18060/mcp",
      "description": "小红书内容发布服务"
    }
  }
}
```

### Claude Code CLI

```bash
claude mcp add --transport http xiaohongshu-mcp http://localhost:18060/mcp
```

### MCP Inspector 测试

```bash
npx @modelcontextprotocol/inspector
# 然后连接到: http://localhost:18060/mcp
```

## 注意事项

1. **首次使用前必须登录**：
   ```bash
   go run cmd/login/main.go
   ```

2. **网络代理**：脚本已自动设置国内Go代理，如有特殊网络需求可修改脚本中的代理设置。

3. **浏览器进程**：GUI模式会启动Chromium浏览器，停止服务时可选择是否一并停止浏览器进程。

4. **日志管理**：建议定期清理日志文件以节省磁盘空间。

5. **权限要求**：脚本需要执行权限，已通过 `chmod +x` 设置。
