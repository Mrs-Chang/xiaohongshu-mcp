# 滚动搜索功能使用说明

## 功能概述

项目现在支持在搜索小红书帖子时进行连续滚动，以加载更多内容。这个功能可以帮助获取比默认搜索更多的帖子结果。

## 功能特点

- ✅ **智能滚动**: 自动滚动到页面底部触发更多内容加载
- ✅ **进度监控**: 实时监控帖子数量变化
- ✅ **自动停止**: 检测到没有新内容时自动停止滚动
- ✅ **可配置参数**: 支持自定义滚动次数和间隔时间
- ✅ **兼容性**: 保持与原有搜索功能的完全兼容

## 使用方法

### 1. 通过MCP接口使用

使用 `search_feeds` 工具，通过 `max_results` 参数控制滚动行为：

```javascript
// 获取默认结果（不滚动）
{
  "name": "search_feeds",
  "arguments": {
    "keyword": "美食"
  }
}

// 获取更多结果（自动滚动）
{
  "name": "search_feeds", 
  "arguments": {
    "keyword": "美食",
    "max_results": 100  // 期望获取100个结果，系统会自动计算需要的滚动次数
  }
}

// 获取尽可能多的结果
{
  "name": "search_feeds",
  "arguments": {
    "keyword": "美食", 
    "max_results": -1  // -1表示尽可能多的结果，会滚动10次
  }
}
```

### 2. 通过Go代码直接调用

#### 服务层调用

```go
// 不滚动的搜索（兼容原有功能）
result, err := service.SearchFeeds(ctx, "美食")

// 带滚动的搜索
result, err := service.SearchFeedsWithScroll(ctx, "美食", 5, 2)
// 参数说明: 关键词, 滚动次数, 滚动间隔(秒)

// 带滚动和URL的增强搜索
result, err := service.SearchFeedsWithURLsAndScroll(ctx, "美食", 3, 2)
```

#### 底层搜索调用

```go
action := xiaohongshu.NewSearchAction(page)

// 不滚动的搜索
feeds, err := action.Search(ctx, "美食")

// 带滚动的搜索
feeds, err := action.SearchWithScroll(ctx, "美食", 5, 2*time.Second)
// 参数说明: 关键词, 滚动次数, 滚动间隔
```

## 参数说明

### max_results (MCP接口)
- `0` 或不设置: 使用默认搜索，不滚动
- `> 0`: 期望的结果数量，系统自动计算滚动次数
- `-1`: 获取尽可能多的结果，滚动10次

### scrollCount (Go接口)
- `0`: 不滚动，使用默认搜索
- `1-10`: 滚动次数，建议不超过10次

### scrollInterval (Go接口)
- `0`: 使用默认间隔(2秒)
- `> 0`: 自定义滚动间隔时间

## 工作原理

1. **初始搜索**: 首先导航到搜索页面并等待初始内容加载
2. **获取基准**: 记录初始的帖子数量
3. **循环滚动**: 
   - 滚动到页面底部
   - 等待新内容加载
   - 检查帖子数量是否增加
   - 如果没有新内容，提前停止
4. **数据获取**: 滚动完成后获取最终的搜索结果

## 滚动逻辑

```javascript
// 页面中执行的滚动JavaScript代码
window.scrollTo({
    top: document.body.scrollHeight,
    behavior: 'smooth'
});
```

## 性能考虑

- **滚动间隔**: 默认2秒间隔，给页面足够时间加载新内容
- **最大次数**: 限制最多10次滚动，避免无限滚动
- **智能停止**: 检测到连续无新内容时自动停止
- **内存管理**: 每次搜索都会创建新的浏览器实例，避免内存泄漏

## 预期效果

- **默认搜索**: 约22个帖子
- **滚动3次**: 约50-80个帖子  
- **滚动5次**: 约80-120个帖子
- **滚动10次**: 约150-250个帖子

> 注意: 实际结果数量取决于小红书的内容加载策略和网络状况

## 使用建议

1. **日常使用**: 使用默认搜索即可满足大部分需求
2. **数据分析**: 需要更多样本时使用滚动功能
3. **批量处理**: 建议设置合适的滚动间隔，避免触发反爬虫机制
4. **网络环境**: 网络较慢时适当增加滚动间隔

## 故障排除

### 常见问题

1. **滚动无效果**: 
   - 检查网络连接
   - 确认小红书页面正常加载
   - 尝试减少滚动次数

2. **结果数量没有增加**:
   - 可能已经到达搜索结果底部
   - 尝试更换关键词
   - 检查是否触发了反爬虫机制

3. **滚动过慢**:
   - 减少滚动间隔时间
   - 但要注意不要设置过短，避免被检测

## 日志输出示例

```
开始滚动加载更多内容，初始帖子数量: 22
第 1/5 次滚动...
滚动后帖子数量: 44 (新增: 22)
第 2/5 次滚动...
滚动后帖子数量: 66 (新增: 22)
第 3/5 次滚动...
滚动后帖子数量: 88 (新增: 22)
第 4/5 次滚动...
滚动后帖子数量: 88 (新增: 0)
检测到没有新内容加载，可能已到达页面底部
滚动完成，最终帖子数量: 88
```

这样你就可以通过滚动功能获取更多的搜索结果了！
